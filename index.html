<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S∆° ƒë·ªì t∆∞ duy Mac-Lenin Interactive</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            overflow: hidden;
            background: radial-gradient(circle, #ffffff 0%, #f0f0f5 100%);
            font-family: 'Segoe UI', 'Arial', sans-serif;
            color: #333;
        }

        #canvas-container {
            width: 100vw;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
        }

        #header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 20px 30px;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.8) 0%, transparent 100%);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }

        #title {
            font-size: 26px;
            font-weight: 700;
            letter-spacing: 2px;
            background: linear-gradient(90deg, #D32F2F, #FF6B6B);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        #camera-preview {
            width: 180px;
            height: 135px;
            border: 3px solid #D32F2F;
            border-radius: 12px;
            transform: scaleX(-1);
            opacity: 0.9;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            background: white;
        }

        #controls {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            z-index: 100;
            background: rgba(255, 255, 255, 0.9);
            padding: 12px 25px;
            border-radius: 50px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid #eee;
        }

        .gesture-hint {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: #555;
        }

        .gesture-icon {
            font-size: 20px;
        }

        #btnStart {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #D32F2F, #8B0000);
            color: white;
            border: none;
            padding: 20px 50px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(211, 47, 47, 0.3);
            z-index: 200;
            transition: 0.3s;
        }

        #btnStart:hover {
            transform: translate(-50%, -50%) scale(1.05);
        }

        #status {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: #D32F2F;
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 100;
        }

        #node-info {
            position: absolute;
            top: 100px;
            left: 30px;
            background: white;
            padding: 20px;
            border-radius: 15px;
            min-width: 250px;
            border-left: 5px solid #D32F2F;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            z-index: 100;
            display: none;
        }

        #node-info h3 {
            color: #D32F2F;
            margin-bottom: 5px;
        }

        #node-info p {
            color: #666;
            font-size: 14px;
            line-height: 1.5;
        }

        #copyright {
            position: absolute;
            bottom: 10px;
            right: 20px;
            color: #999;
            font-size: 11px;
            z-index: 100;
        }

        .video-hidden {
            display: none;
        }

        #detail-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.98);
            z-index: 300;
            display: none;
            opacity: 0;
            transition: 0.5s;
            overflow-y: auto;
        }

        #detail-overlay.active {
            display: block;
            opacity: 1;
        }

        #detail-container {
            max-width: 1000px;
            margin: 40px auto;
            padding: 30px;
            color: #333;
        }

        #detail-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        #detail-back {
            background: #D32F2F;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 30px;
            cursor: pointer;
        }

        #detail-title {
            font-size: 36px;
            color: #D32F2F;
            font-weight: 800;
        }

        #detail-description {
            font-size: 18px;
            line-height: 1.8;
            color: #444;
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 10px;
            background: #fdf2f2;
        }

        .event-item {
            display: flex;
            gap: 20px;
            padding: 15px;
            background: #fff;
            border-bottom: 1px solid #eee;
        }

        .event-date {
            color: #D32F2F;
            font-weight: 700;
            min-width: 80px;
        }

        #detail-subnodes {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .subnode-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #eee;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .subnode-card h4 {
            color: #D32F2F;
            margin-bottom: 5px;
        }
    </style>
</head>

<body>
    <div id="canvas-container"></div>
    <div id="header">
        <div id="title">‚ò≠ CH·ª¶ NGHƒ®A M√ÅC-L√äNIN</div>
        <canvas id="camera-preview"></canvas>
    </div>
    <button id="btnStart" onclick="startSystem()">B·∫ÆT ƒê·∫¶U TR·∫¢I NGHI·ªÜM TAY</button>
    <div id="status">ƒêang t·∫£i h·ªá th·ªëng...</div>
    <div id="node-info">
        <h3 id="node-title">Ti√™u ƒë·ªÅ</h3>
        <p id="node-desc">M√¥ t·∫£ chi ti·∫øt</p>
    </div>
    <div id="controls">
        <div class="gesture-hint"><span class="gesture-icon">üñê</span><span>X√≤e tay: Pan</span></div>
        <div class="gesture-hint"><span class="gesture-icon">‚úåÔ∏è</span><span>2 ng√≥n: Ch·ªçn</span></div>
        <div class="gesture-hint"><span class="gesture-icon">ü§è</span><span>Pinch: V√†o</span></div>
        <div class="gesture-hint"><span class="gesture-icon">‚úä</span><span>N·∫Øm ƒë·∫•m: Tr·ªü v·ªÅ</span></div>
    </div>
    <div id="detail-overlay">
        <div id="detail-container">
            <div id="detail-header">
                <button id="detail-back" onclick="exitDetailView()">‚úä QUAY L·∫†I</button>
                <h1 id="detail-title">Ti√™u ƒë·ªÅ</h1>
            </div>
            <div id="detail-description">M√¥ t·∫£</div>
            <div id="detail-events"></div>
            <div id="detail-subnodes"></div>
        </div>
    </div>
    <div id="copyright">¬© 2026 Mac-Lenin Interactive by nguyencongtuyenlp</div>
    <video class="video-hidden input_video"></video>

    <script>
        const timelineData = {
            nodes: [
                { id: 1, label: "H·ªá t∆∞ t∆∞·ªüng M√°c", desc: "Ngu·ªìn g·ªëc v√† s·ª± h√¨nh th√†nh", x: -120, y: 0, color: 0xD32F2F, content: { description: "Giai ƒëoan h√¨nh th√†nh th·∫ø gi·ªõi quan khoa h·ªçc c·ªßa C.M√°c v√† Ph.ƒÇngghen.", events: [{ date: "1848", title: "Tuy√™n ng√¥n", desc: "B∆∞·ªõc ngo·∫∑t l√Ω lu·∫≠n" }], subNodes: [{ label: "Duy v·∫≠t bi·ªán ch·ª©ng", desc: "H·∫°t nh√¢n tri·∫øt h·ªçc" }] } },
                { id: 2, label: "Kinh t·∫ø ch√≠nh tr·ªã", desc: "H·ªçc thuy·∫øt gi√° tr·ªã th·∫∑ng d∆∞", x: -40, y: -40, color: 0xC62828, content: { description: "Ph√¢n t√≠ch quy lu·∫≠t v·∫≠n ƒë·ªông c·ªßa ph∆∞∆°ng th·ª©c s·∫£n xu·∫•t t∆∞ b·∫£n ch·ªß nghƒ©a.", subNodes: [{ label: "H√†ng h√≥a", desc: "ƒêi·ªÉm xu·∫•t ph√°t" }] } },
                { id: 3, label: "Ch·ªß nghƒ©a x√£ h·ªôi", desc: "L√Ω lu·∫≠n v·ªÅ gi·∫£i ph√≥ng giai c·∫•p", x: -40, y: 40, color: 0xB71C1C, content: { description: "Con ƒë∆∞·ªùng gi·∫£i ph√≥ng x√£ h·ªôi th√¥ng qua c√°ch m·∫°ng v√¥ s·∫£n.", subNodes: [{ label: "S·ª© m·ªánh giai c·∫•p", desc: "Vai tr√≤ l·ªãch s·ª≠" }] } },
                { id: 4, label: "L√™nin ph√°t tri·ªÉn", desc: "Giai ƒëo·∫°n ƒë·∫ø qu·ªëc ch·ªß nghƒ©a", x: 40, y: 0, color: 0xFF1744, content: { description: "B·∫£o v·ªá v√† ph√°t tri·ªÉn ch·ªß nghƒ©a M√°c trong ƒëi·ªÅu ki·ªán l·ªãch s·ª≠ m·ªõi.", subNodes: [{ label: "ƒê·∫£ng ki·ªÉu m·ªõi", desc: "ƒê·ªôi ti√™n phong" }] } },
                { id: 5, label: "Th√†nh t·ª±u to√†n c·∫ßu", desc: "S·ª©c s·ªëng th·ªùi ƒë·∫°i", x: 120, y: 0, color: 0xFF5252, content: { description: "S·ª± s·ª•p ƒë·ªï c·ªßa h·ªá th·ªëng thu·ªôc ƒë·ªãa v√† s·ª± ra ƒë·ªùi c·ªßa c√°c n∆∞·ªõc XHCN.", subNodes: [{ label: "Th·∫ø k·ª∑ 21", desc: "T·∫ßm v√≥c m·ªõi" }] } }
            ],
            connections: [{ from: 1, to: 2 }, { from: 1, to: 3 }, { from: 2, to: 4 }, { from: 3, to: 4 }, { from: 4, to: 5 }]
        };

        let scene, camera, renderer, timelineGroup, nodeMeshes = [], connectionLines = [];
        let currentZoom = 1.0, panOffset = { x: 0, y: 0 };
        let selectedNode = null;
        let prevPanPos = null, prevPinchDist = 0, isInDetailView = false;

        function init3D() {
            const container = document.getElementById('canvas-container');
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 150;
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);

            timelineGroup = new THREE.Group();
            scene.add(timelineGroup);

            createNodes();
            createConnections();
            createBackgroundParticles();
            animate();
        }

        function createNodes() {
            timelineData.nodes.forEach(node => {
                const geo = new THREE.SphereGeometry(10, 32, 32);
                const mat = new THREE.MeshPhongMaterial({ color: node.color, shininess: 100, emissive: node.color, emissiveIntensity: 0.2 });
                const mesh = new THREE.Mesh(geo, mat);
                mesh.position.set(node.x, node.y, 0);
                mesh.userData = node;
                timelineGroup.add(mesh);
                nodeMeshes.push(mesh);

                const canvas = document.createElement('canvas');
                canvas.width = 300; canvas.height = 60;
                const ctx = canvas.getContext('2d');
                ctx.font = 'bold 24px Arial'; ctx.fillStyle = '#D32F2F'; ctx.textAlign = 'center';
                ctx.fillText(node.label, 150, 40);
                const tex = new THREE.CanvasTexture(canvas);
                const spriteMat = new THREE.SpriteMaterial({ map: tex });
                const sprite = new THREE.Sprite(spriteMat);
                sprite.scale.set(40, 8, 1);
                sprite.position.set(node.x, node.y - 18, 0);
                timelineGroup.add(sprite);
            });
            const light = new THREE.PointLight(0xffffff, 1, 500); light.position.set(0, 0, 100); scene.add(light);
            scene.add(new THREE.AmbientLight(0xffffff, 0.6));
        }

        function createConnections() {
            const mat = new THREE.LineBasicMaterial({ color: 0xD32F2F, transparent: true, opacity: 0.2 });
            timelineData.connections.forEach(c => {
                const f = timelineData.nodes.find(n => n.id === c.from), t = timelineData.nodes.find(n => n.id === c.to);
                const points = [new THREE.Vector3(f.x, f.y, 0), new THREE.Vector3(t.x, t.y, 0)];
                const geo = new THREE.BufferGeometry().setFromPoints(points);
                timelineGroup.add(new THREE.Line(geo, mat));
            });
        }

        function createBackgroundParticles() {
            const geo = new THREE.BufferGeometry();
            const pos = [];
            for (let i = 0; i < 1000; i++) {
                pos.push((Math.random() - 0.5) * 600, (Math.random() - 0.5) * 400, (Math.random() - 0.5) * 200);
            }
            geo.setAttribute('position', new THREE.Float32BufferAttribute(pos, 3));
            const mat = new THREE.PointsMaterial({ color: 0xD32F2F, size: 1.5, transparent: true, opacity: 0.1 });
            scene.add(new THREE.Points(geo, mat));
        }

        function animate() {
            requestAnimationFrame(animate);
            timelineGroup.scale.set(currentZoom, currentZoom, 1);
            timelineGroup.position.set(panOffset.x, panOffset.y, 0);
            nodeMeshes.forEach(m => m.rotation.y += 0.01);
            renderer.render(scene, camera);
        }

        function onHandResults(results) {
            const ctx = document.getElementById('camera-preview').getContext('2d');
            ctx.clearRect(0, 0, 180, 135); ctx.drawImage(results.image, 0, 0, 180, 135);

            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                const lm = results.multiHandLandmarks[0];
                const palm = lm[9];
                const fingers = [8, 12, 16, 20].map(i => lm[i].y < lm[i - 2].y);
                const upCount = fingers.filter(Boolean).length;
                const pinchDist = Math.hypot(lm[4].x - lm[8].x, lm[4].y - lm[8].y);

                if (upCount === 0) { // Fist - back
                    if (isInDetailView) exitDetailView();
                    document.getElementById('status').innerText = "‚úä N·∫ÆM ƒê·∫§M - QUAY L·∫†I";
                } else if (upCount === 2) { // 2 fingers - select
                    const mx = (1 - palm.x) * 2 - 1, my = -(palm.y * 2 - 1);
                    const ray = new THREE.Raycaster(); ray.setFromCamera({ x: mx, y: my }, camera);
                    const hits = ray.intersectObjects(nodeMeshes);
                    if (hits.length > 0) {
                        selectedNode = hits[0].object.userData;
                        document.getElementById('node-info').style.display = 'block';
                        document.getElementById('node-title').innerText = selectedNode.label;
                        document.getElementById('node-desc').innerText = selectedNode.desc;
                    }
                    document.getElementById('status').innerText = "‚úåÔ∏è 2 NG√ìN - CH·ªåN NODE";
                } else if (pinchDist < 0.08) { // Pinch - enter
                    if (selectedNode && !isInDetailView) openDetailView(selectedNode);
                    document.getElementById('status').innerText = "ü§è PINCH - V√ÄO CHI TI·∫æT";
                } else if (upCount === 4) { // Open - pan
                    if (prevPanPos) { panOffset.x += (prevPanPos.x - palm.x) * 300; panOffset.y -= (prevPanPos.y - palm.y) * 300; }
                    prevPanPos = { x: palm.x, y: palm.y };
                    document.getElementById('status').innerText = "üñê X√íE TAY - DI CHUY·ªÇN";
                } else { prevPanPos = null; }
            }
        }

        function openDetailView(node) {
            isInDetailView = true; document.getElementById('detail-overlay').classList.add('active');
            document.getElementById('detail-title').innerText = node.label;
            document.getElementById('detail-description').innerText = node.content.description;
            // Render sub-nodes, events...
            document.getElementById('detail-subnodes').innerHTML = node.content.subNodes.map(s => `<div class="subnode-card"><h4>${s.label}</h4><p>${s.desc}</p></div>`).join('');
        }
        function exitDetailView() { isInDetailView = false; document.getElementById('detail-overlay').classList.remove('active'); }

        async function startSystem() {
            document.getElementById('btnStart').style.display = 'none';
            const video = document.querySelector('.input_video');
            const hands = new Hands({ locateFile: f => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}` });
            hands.setOptions({ maxNumHands: 2, minDetectionConfidence: 0.7 });
            hands.onResults(onHandResults);
            const cameraUtils = new Camera(video, { onFrame: async () => await hands.send({ image: video }), width: 640, height: 480 });
            cameraUtils.start();
            document.getElementById('status').innerText = "‚úÖ H·ªÜ TH·ªêNG ƒê√É S·∫¥N S√ÄNG";
        }

        init3D();
    </script>
</body>

</html>